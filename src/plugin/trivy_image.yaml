name: trivy_image_scan
provider: trivy
variables: 
- name: registry_image
  default: "nginx:latest"
  description: name of image
- name: registry_host
  default: "registry.hub.docker.com"
  description: provide the registry host
- name: registry_username
  default: "registry username"
  description: username of the registry
- name: registry_password
  default: "registry password"
  description: password of the registry
command: "trivy image --no-progress {{registry_image}} --docker-host {{registry_host}} --username {{registry_username}}  --password {{registry_password}} --format json --timeout 15m" 
output: 
  data: Results[0].Vulnerabilities
  identifier: VulnerabilityID
  createdAt: PublishedDate
  updatedAt: LastModifiedDate
  title: VulnerabilityID
  severity: Severity
  package: PkgID
  references: References
  installed_version: InstalledVersion
  description: Title
  recommendation : FixedVersion
  fixed_version : FixedVersion
  source: "trivy"
  blueprint: "registry"
  icon: "https://aquasecurity.github.io/trivy/dev/imgs/logo.png"
  status: Status
dependency:
  name: trivy
  version: "0.48.3"
  script: "apt-get update -y && apt-get install -y wget && wget https://storage.googleapis.com/zerone-uploads/binaries/trivy-v0.48.3 -O /usr/local/bin/trivy && chmod +x /usr/local/bin/trivy"