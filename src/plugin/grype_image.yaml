name: grype_image_scan
provider: grype
variables: 
- name: image
  default: "nginx:latest"
  description: name of image
- name: registry_host
  default: "registry.hub.docker.com"
  description: provide the registry host
- name: username
  default: "username"
  description: username of the registry
- name: password
  default: "password"
  description: password of the registry
command: "export GRYPE_REGISTRY_AUTH_AUTHORITY={{registry_host}} && export GRYPE_REGISTRY_AUTH_USERNAME={{username}} &&  export GRYPE_REGISTRY_AUTH_PASSWORD={{password}} && grype {{image}} -o json" 
output: 
  data: matches
  identifier: vulnerability.id
  title: vulnerability.id
  severity: vulnerability.severity
  description: vulnerability.description
  source: "grype"
  status: vulnerability.fix.state
  package: matchDetails[0].searchedBy.package.name
dependency:
  name: grype
  version: "0.74.3"
  script: "apt-get update -y && apt-get install -y wget && wget https://storage.googleapis.com/zerone-uploads/binaries/grype-v0.74.3 -O /usr/local/bin/grype && chmod +x /usr/local/bin/grype"