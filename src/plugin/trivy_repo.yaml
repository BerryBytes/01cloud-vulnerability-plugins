name: trivy_repo_scan
provider: trivy
variables: 
- name: git_repo
  default: "repo_path"
  description: path of the repo
- name: git_branch
  default: "main"
  description: scannig branch
- name: git_token
  default: ""
  description: git_token of the repo
command: "trivy repo --branch {{git_branch}} --no-progress https://{{git_token}}@{{git_repo}} --format json --timeout 15m" 
output: 
  data: Results[0].Vulnerabilities
  identifier: VulnerabilityID
  createdAt: PublishedDate
  updatedAt: LastModifiedDate
  title: VulnerabilityID
  severity: Severity
  icon: "https://aquasecurity.github.io/trivy/dev/imgs/logo.png"
  source: "trivy"
  fixed_version: FixedVersion
  package: PkgID
  recommendation : FixedVersion
  installed_version: InstalledVersion
  description: Title
  blueprint: "repository"
  team: "trivy"
  status: Status
dependency:
  name: trivy
  version: "0.48.3"
  script: "apt-get update -y && apt-get install -y  wget && wget https://storage.googleapis.com/zerone-uploads/binaries/trivy-v0.48.3 -O /usr/local/bin/trivy && chmod +x /usr/local/bin/trivy"