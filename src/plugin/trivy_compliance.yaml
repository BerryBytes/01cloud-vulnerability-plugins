name: trivy_compliance
provider: trivy
variables: 
- name: k8s_kubeconfig
  default: "/tmp/k8s_kubeconfig.yaml"
  description: kubeconfig of cluster
command: "echo {{k8s_kubeconfig}} | base64 --decode > /tmp/k8s_kubeconfig.yaml && trivy k8s --kubeconfig /tmp/k8s_kubeconfig.yaml --compliance k8s-cis-1.23 --format json --timeout 30m"
output: 
  # data: Resources[0].Results[0].Vulnerabilities
  # identifier: VulnerabilityID
  # title: Title
  # severity: Severity
  # source: "trivy"
  # description: Description
  # package: PkgName
  # installed_version: InstalledVersion
  # fixed_version: FixedVersion
  # recommendation: FixedVersion
  # team: "trivy"
  # icon: "https://aquasecurity.github.io/trivy/dev/imgs/logo.png"
  # blueprint: "k8s"
  # status: Status
dependency:
  name: trivy
  version: "0.48.3"
  script: "apt-get update -y && apt-get install -y wget && wget https://storage.googleapis.com/zerone-uploads/binaries/trivy-v0.48.3 -O /usr/local/bin/trivy && chmod +x /usr/local/bin/trivy"